/*   Tlbx SQLite3.incl      Based on Tlbx SQLite3Expanded.incl issued 2001 September 15   Converted to FBtoC  {20090128} svv and rp   Updated and Expanded  {20130408} Brian and Bernie   Abbreviated, Modified and Updated {20201201} Ken   Note: To supress compiler errors, requires FBtoC's Build Settings   Compiler options to include:      -lsqlite3   even though that flag apparently is unused by clang.*/BeginCDeclaration#include <sqlite3.h>EndC#define sqlite3Ptr as ptr#define sqlite3_stmtPtr as ptr#define sqlite3_contextPtr as ptr#define sqlite3_blobPtr as Ptr#define sqlite3_valuePtr as ptr#define sqlite3_vtabPtr as ptr#define sqlite3_index_infoPtr as ptr#define sqlite3_vtab_cursorPtr as Ptr#define sqlite3_modulePtr as ptr#define sqlite_int64  as SInt64#define sqlite_uint64 as UInt64// Data typesbegin enum_SQLITEINTEGER = 1_SQLITEFLOAT   = 2_SQLITE3TEXT   = 3_SQLITEBLOB    = 4_SQLITENULL    = 5end enum// Error Codesbegin enum_SQLITEOK          =  0   /* Successful result *//* beginning-of-error-codes */_SQLITEERROR       =  1   /* SQL error or missing database */_SQLITEINTERNAL    =  2   /* NOT USED. Internal logic error in SQLite */_SQLITEPERM        =  3   /* Access permission denied */_SQLITEABORT       =  4   /* Callback routine requested an abort */_SQLITEBUSY        =  5   /* The database file is locked */_SQLITELOCKED      =  6   /* A table in the database is locked */_SQLITENOMEM       =  7   /* A malloc() failed */_SQLITEREADONLY    =  8   /* Attempt to write a readonly database */_SQLITEINTERRUPT   =  9   /* Operation terminated by sqlite3_interrupt()*/_SQLITEIOERR       = 10   /* Some kind of disk I/O error occurred */_SQLITECORRUPT     = 11   /* The database disk image is malformed */_SQLITENOTFOUND    = 12   /* NOT USED. Table or record not found */_SQLITEFULL        = 13   /* Insertion failed because database is full */_SQLITECANTOPEN    = 14   /* Unable to open the database file */_SQLITEPROTOCOL    = 15   /* NOT USED. Database lock protocol error */_SQLITEEMPTY       = 16   /* Database is empty */_SQLITESCHEMA      = 17   /* The database schema changed */_SQLITETOOBIG      = 18   /* String or BLOB exceeds size limit */_SQLITECONSTRAINT  = 19   /* Abort due to contraint violation */_SQLITEMISMATCH    = 20   /* Data type mismatch */_SQLITEMISUSE      = 21   /* Library used incorrectly */_SQLITENOLFS       = 22   /* Uses OS features not supported on host */_SQLITEAUTH        = 23   /* Authorization denied */_SQLITEFORMAT      = 24   /* Auxiliary database format error */_SQLITERANGE       = 25   /* 2nd parameter to sqlite3_bind out of range */_SQLITENOTADB      = 26   /* File opened that is not a database file */_SQLITEROW         = 100  /* sqlite3_step() has another row ready */_SQLITEDONE        = 101  /* sqlite3_step() has finished executing */end enumtoolbox fn sqlite3_libversion() = ptrtoolbox fn sqlite3_libversion_number() = longtoolbox fn sqlite3_close( sqlite3Ptr ) = longsystem long SQLITE_IOERR             // 10system long SQLITE_IOERR_READ        // (SQLITE_IOERR | (1<<8 ) )system long SQLITE_IOERR_SHORT_READ  // (SQLITE_IOERR | (2<<8 ) )system long SQLITE_IOERR_WRITE       // (SQLITE_IOERR | (3<<8 ) )system long SQLITE_IOERR_FSYNC       // (SQLITE_IOERR | (4<<8 ) )system long SQLITE_IOERR_DIR_FSYNC   // (SQLITE_IOERR | (5<<8 ) )system long SQLITE_IOERR_TRUNCATE    // (SQLITE_IOERR | (6<<8 ) )system long SQLITE_IOERR_FSTAT       // (SQLITE_IOERR | (7<<8 ) )system long SQLITE_IOERR_UNLOCK      // (SQLITE_IOERR | (8<<8 ) )system long SQLITE_IOERR_RDLOCK      // (SQLITE_IOERR | (9<<8 ) )system long SQLITE_IOERR_DELETE      // (SQLITE_IOERR | (10<<8 ) )system long SQLITE_IOERR_BLOCKED     // (SQLITE_IOERR | (11<<8 ) )toolbox fn sqlite3_extended_result_codes( sqlite3Ptr, long ) = longtoolbox fn sqlite3_last_insert_rowid( sqlite3Ptr ) = sqlite_int64toolbox fn sqlite3_changes( sqlite3Ptr ) = longtoolbox fn sqlite3_total_changes( sqlite3Ptr ) = longtoolbox sqlite3_interrupt(sqlite3Ptr )toolbox fn sqlite3_complete( ptr ) = longtoolbox fn sqlite3_complete16( ptr ) = longtoolbox fn sqlite3_busy_handler( sqlite3Ptr, ptr callback, ptr ) = longtoolbox fn sqlite3_busy_timeout( sqlite3Ptr, long ) = longtoolbox fn sqlite3_get_table( sqlite3Ptr, ptr,  ptr,  long,  long,  ptr )  = longtoolbox sqlite3_free_table( ptr )toolbox fn sqlite3_malloc( long ) = ptrtoolbox fn sqlite3_realloc( ptr, long ) = ptrtoolbox sqlite3_free()toolbox fn sqlite3_set_authorizer( sqlite3Ptr, ptr xAuth, ptr ) = long_SQLITEDENY   = 1  /* Abort the SQL statement with an error */_SQLITEIGNORE = 2  /* Don't allow access, but don't generate an error */begin enum_SQLITECREATEINDEX       =  1   /* Index Name      Table Name      */_SQLITECREATETABLE       =  2   /* Table Name      NULL            */_SQLITECREATETEMPINDEX   =  3   /* Index Name      Table Name      */_SQLITECREATETEMPTABLE   =  4   /* Table Name      NULL            */_SQLITECREATETEMPTRIGGER =  5   /* Trigger Name    Table Name      */_SQLITECREATETEMPVIEW    =  6   /* View Name       NULL            */_SQLITECREATETRIGGER     =  7   /* Trigger Name    Table Name      */_SQLITECREATEVIEW        =  8   /* View Name       NULL            */_SQLITEDELETE            =  9   /* Table Name      NULL            */_SQLITEDROPINDEX         = 10   /* Index Name      Table Name      */_SQLITEDROPTABLE         = 11   /* Table Name      NULL            */_SQLITEDROPTEMPINDEX     = 12   /* Index Name      Table Name      */_SQLITEDROPTEMPTABLE     = 13   /* Table Name      NULL            */_SQLITEDROPTEMPTRIGGER   = 14   /* Trigger Name    Table Name      */_SQLITEDROPTEMPVIEW      = 15   /* View Name       NULL            */_SQLITEDROPTRIGGER       = 16   /* Trigger Name    Table Name      */_SQLITEDROPVIEW          = 17   /* View Name       NULL            */_SQLITEINSERT            = 18   /* Table Name      NULL            */_SQLITEPRAGMA            = 19   /* Pragma Name     1st arg or NULL */_SQLITEREAD              = 20   /* Table Name      Column Name     */_SQLITESELECT            = 21   /* NULL            NULL            */_SQLITETRANSACTION       = 22   /* NULL            NULL            */_SQLITEUPDATE            = 23   /* Table Name      Column Name     */_SQLITEATTACH            = 24   /* Filename        NULL            */_SQLITEDETACH            = 25   /* Database Name   NULL            */_SQLITEALTERTABLE        = 26   /* Database Name   Table Name      */_SQLITEREINDEX           = 27   /* Index Name      NULL            */_SQLITEANALYZE           = 28   /* Table Name      NULL            */_SQLITECREATEVTABLE      = 29   /* Table Name      Module Name     */_SQLITEDROPVTABLE        = 30   /* Table Name      Module Name     */_SQLITEFUNCTION          = 31   /* Function Name   NULL            */_SQLITECOPY              =  0   /* No longer used                  */end enumtoolbox fn sqlite3_trace( sqlite3Ptr, ptr xTrace, ptr ) = ptrtoolbox fn sqlite3_profile( sqlite3Ptr,  ptr xProfile, ptr ) = ptrtoolbox sqlite3_progress_handler( sqlite3Ptr, long,  ptr callback, ptr )toolbox fn sqlite3_open( const char *filename, sqlite3Ptr *ppDb ) = longtoolbox fn sqlite3_open16( ptr filename, sqlite3Ptr  *ppDb ) = Longtoolbox fn sqlite3_errcode( sqlite3Ptr db ) = longtoolbox fn sqlite3_errmsg( sqlite3Ptr ) = ptrtoolbox fn sqlite3_errmsg16( sqlite3Ptr ) = ptrtoolbox fn sqlite3_prepare( sqlite3Ptr,  const char *zSql, long nBytes, sqlite3_stmtPtr  *ppStmt , const char **pzTail )  = longtoolbox fn sqlite3_prepare_v2( sqlite3Ptr,  const char *zSql,  long nBytes,  sqlite3_stmtPtr  *ppStmt,   const char **pzTail ) = longtoolbox fn sqlite3_prepare16( sqlite3Ptr, ptr,  long nBytes,  sqlite3_stmtPtr  *ppStmt,   ptr ) = longtoolbox fn sqlite3_prepare16_v2( sqlite3Ptr,   ptr,  long nBytes,  sqlite3_stmtPtr  *ppStmt,  ptr ) = longtoolbox fn sqlite3_bind_blob( sqlite3_stmtPtr, long, ptr, long, ptr ) = longtoolbox fn sqlite3_bind_double( sqlite3_stmtPtr, long, double ) = longtoolbox fn sqlite3_bind_int( sqlite3_stmtPtr, long, long ) = longtoolbox fn sqlite3_bind_int64( sqlite3_stmtPtr, long, sqlite_int64 ) = longtoolbox fn sqlite3_bind_null( sqlite3_stmtPtr, long ) = longtoolbox fn sqlite3_bind_text( sqlite3_stmtPtr, long, ptr, long, ptr ) = longtoolbox fn sqlite3_bind_text16( sqlite3_stmtPtr, long, ptr, long, ptr ) = longtoolbox fn sqlite3_bind_value( sqlite3_stmtPtr, long, const sqlite3_valuePtr ) = longtoolbox fn sqlite3_bind_zeroblob( sqlite3_stmtPtr, long, long ) = longtoolbox fn sqlite3_bind_parameter_count( sqlite3_stmtPtr ) = longtoolbox fn sqlite3_bind_parameter_name( sqlite3_stmtPtr, long ) = ptrtoolbox fn sqlite3_bind_parameter_index( sqlite3_stmtPtr, const char *zName ) = longtoolbox fn sqlite3_clear_bindings( sqlite3_stmtPtr ) = longtoolbox fn sqlite3_column_count( sqlite3_stmtPtr *pStmt ) = longtoolbox fn sqlite3_column_name( sqlite3_stmtPtr, long N ) = ptrtoolbox fn sqlite3_column_name16( sqlite3_stmtPtr, long N ) = ptrtoolbox fn sqlite3_column_database_name( sqlite3_stmtPtr, long ) = ptrtoolbox fn sqlite3_column_database_name16( sqlite3_stmtPtr, long ) = ptrtoolbox fn sqlite3_column_table_name( sqlite3_stmtPtr, long ) = ptrtoolbox fn sqlite3_column_table_name16( sqlite3_stmtPtr, long ) = ptrtoolbox fn sqlite3_column_origin_name( sqlite3_stmtPtr, long ) = ptrtoolbox fn sqlite3_column_origin_name16( sqlite3_stmtPtr, long ) = ptrtoolbox fn sqlite3_column_decltype( sqlite3_stmtPtr, long i ) = ptrtoolbox fn sqlite3_column_decltype16( sqlite3_stmtPtr, long ) = ptrtoolbox fn sqlite3_step( sqlite3_stmtPtr ) = longtoolbox fn sqlite3_data_count( sqlite3_stmtPtr pStmt ) = longtoolbox fn sqlite3_column_blob( sqlite3_stmtPtr, long iCol ) = ptrtoolbox fn sqlite3_column_bytes( sqlite3_stmtPtr, long iCol ) = longtoolbox fn sqlite3_column_bytes16( sqlite3_stmtPtr, long iCol ) = longtoolbox fn sqlite3_column_double( sqlite3_stmtPtr, long iCol ) = Doubletoolbox fn sqlite3_column_int( sqlite3_stmtPtr, long iCol ) = longtoolbox fn sqlite3_column_int64( sqlite3_stmtPtr, long iCol ) = sqlite_int64toolbox fn sqlite3_column_text( sqlite3_stmtPtr, long iCol ) = ptrtoolbox fn sqlite3_column_text16( sqlite3_stmtPtr, long iCol ) = ptrtoolbox fn sqlite3_column_type( sqlite3_stmtPtr, long iCol ) = longtoolbox fn sqlite3_column_value( sqlite3_stmtPtr, long iCol ) = sqlite3_valuePtrtoolbox fn sqlite3_finalize( sqlite3_stmtPtr  pStmt ) = longtoolbox fn sqlite3_reset(sqlite3_stmtPtr  pStmt ) = longtoolbox fn sqlite3_create_function( sqlite3Ptr, const char *zFunctionName,  long nArg, long eTextRep,  ptr, ptr xFunc, ptr xStep,  ptr xFinal ) = longtoolbox fn sqlite3_create_function16( sqlite3Ptr,  ptr *zFunctionName,  long nArg, long eTextRep, ptr,  ptr xFunc,  ptr xStep,   ptr xFinal ) = longbegin enum_SQLITEUTF8          = 1_SQLITEUTF16LE       = 2_SQLITEUTF16BE       = 3_SQLITEUTF16         = 4  /* Use native byte order         */_SQLITEANY           = 5  /* sqlite3_create_function only  */_SQLITEUTF16ALIGNED  = 8  /* sqlite3_create_collation only */end enumtoolbox fn sqlite3_aggregate_count( sqlite3_contextPtr ) = longtoolbox fn sqlite3_expired( sqlite3_stmtPtr ) = longtoolbox fn sqlite3_transfer_bindings( sqlite3_stmtPtr, sqlite3_stmtPtr ) = longtoolbox fn sqlite3_global_recover() = longtoolbox fn sqlite3_value_blob( sqlite3_valuePtr ) = ptrtoolbox fn sqlite3_value_bytes( sqlite3_valuePtr ) = longtoolbox fn sqlite3_value_bytes16( sqlite3_valuePtr ) = longtoolbox fn sqlite3_value_double( sqlite3_valuePtr ) = doubletoolbox fn sqlite3_value_int( sqlite3_valuePtr ) = longtoolbox fn sqlite3_value_int64( sqlite3_valuePtr ) = sqlite_int64toolbox fn sqlite3_value_text( sqlite3_valuePtr ) = ptrtoolbox fn sqlite3_value_text16( sqlite3_valuePtr ) = ptrtoolbox fn sqlite3_value_text16le( sqlite3_valuePtr ) = ptrtoolbox fn sqlite3_value_text16be( sqlite3_valuePtr ) = ptrtoolbox fn sqlite3_value_type( sqlite3_valuePtr ) = longtoolbox fn sqlite3_value_numeric_type( sqlite3_valuePtr ) = longtoolbox fn sqlite3_aggregate_context( sqlite3_contextPtr, long nBytes ) = ptrtoolbox fn sqlite3_user_data( sqlite3_contextPtr ) = ptrtoolbox fn sqlite3_get_auxdata( sqlite3_contextPtr, long ) = ptrtoolbox sqlite3_set_auxdata(sqlite3_contextPtr, long, ptr, ptr )_STATIC    =  0_TRANSIENT = -1toolbox sqlite3_result_blob( sqlite3_contextPtr, ptr, Long, ptr )toolbox sqlite3_result_double( sqlite3_contextPtr, double )toolbox sqlite3_result_error( sqlite3_contextPtr, const char*, short )toolbox sqlite3_result_error16( sqlite3_contextPtr, ptr, long )toolbox sqlite3_result_error_toobig( sqlite3_contextPtr )toolbox sqlite3_result_int( sqlite3_contextPtr, long )toolbox sqlite3_result_int64( sqlite3_contextPtr, sqlite_int64 )toolbox sqlite3_result_null( sqlite3_contextPtr )toolbox sqlite3_result_text( sqlite3_contextPtr, ptr, long, ptr )toolbox sqlite3_result_text16( sqlite3_contextPtr, ptr, long, ptr )toolbox sqlite3_result_text16le( sqlite3_contextPtr, ptr, long, ptr )toolbox sqlite3_result_text16be( sqlite3_contextPtr, ptr, long, ptr )toolbox sqlite3_result_value( sqlite3_contextPtr, sqlite3_valuePtr )toolbox sqlite3_result_zeroblob( sqlite3_contextPtr, long n )toolbox fn sqlite3_create_collation( sqlite3Ptr, ptr, long,  ptr,  ptr xCompare ) = longtoolbox fn sqlite3_create_collation_v2( sqlite3Ptr,  ptr, long,  ptr,  ptr xCompare,  ptr ) = longtoolbox fn sqlite3_create_collation16( sqlite3Ptr,  ptr,  long,  ptr, ptr xCompare ) = longtoolbox fn sqlite3_collation_needed( sqlite3Ptr,  ptr,  ptr callback )  = longtoolbox fn sqlite3_collation_needed16( sqlite3Ptr,  ptr,  ptr callback ) = longtoolbox fn sqlite3_key( sqlite3Ptr, ptr *pKey, long nKey ) = longtoolbox fn sqlite3_rekey( sqlite3Ptr ,  ptr *pKey, long nKey ) = longtoolbox fn sqlite3_sleep( long ) = longtoolbox fn sqlite3_get_autocommit( sqlite3Ptr ) = longtoolbox fn sqlite3_db_handle( sqlite3_stmtPtr ) = sqlite3Ptrtoolbox fn sqlite3_commit_hook( sqlite3Ptr, ptr,  ptr ) = ptrtoolbox fn sqlite3_rollback_hook( sqlite3Ptr, ptr, ptr ) = ptrtoolbox fn sqlite3_update_hook( sqlite3Ptr, ptr callback,   ptr )  = ptrtoolbox fn sqlite3_enable_shared_cache( long ) = longtoolbox fn sqlite3_release_memory( long ) = longtoolbox sqlite3_soft_heap_limit( long )toolbox sqlite3_thread_cleanup()toolbox fn sqlite3_table_column_metadata( sqlite3Ptr,  const char *zDbName,  const char *zTableName,  const char *zColumnName, ptr  outDataType, ptr  outCollSeq,   long outNotNull,  long outPrimaryKey,  long outAutoinc ) = longtoolbox fn sqlite3_load_extension( sqlite3Ptr,   const char *zFile, const char *zProc, char **pzErrMsg ) = longtoolbox fn sqlite3_enable_load_extension( sqlite3Ptr, long onoff ) = longtoolbox fn sqlite3_auto_extension( ptr xEntryPoint ) = longtoolbox sqlite3_reset_auto_extension()begin enum_SQLITEINDEXCONSTRAINTEQ    =  2_SQLITEINDEXCONSTRAINTGT    =  4_SQLITEINDEXCONSTRAINTLE    =  8_SQLITEINDEXCONSTRAINTLT    = 16_SQLITEINDEXCONSTRAINTGE    = 32_SQLITEINDEXCONSTRAINTMATCH = 64end enumtoolbox fn sqlite3_create_module( sqlite3Ptr,  const char *zName,  sqlite3_modulePtr, ptr ) = longtoolbox fn sqlite3_declare_vtab( sqlite3Ptr, const char *zCreateTable ) = longtoolbox fn sqlite3_overload_function( sqlite3Ptr, const char *zFuncName, long nArg ) = longtoolbox fn sqlite3_blob_open( sqlite3Ptr, const char *zDb ,  const char *zTable,  const char *zColumn, sqlite_int64  iRow, long flags,  sqlite3_blobPtr ) = longtoolbox fn sqlite3_blob_close( sqlite3_blobPtr ) = longtoolbox fn sqlite3_blob_bytes( sqlite3_blobPtr ) = longtoolbox fn sqlite3_blob_read( sqlite3_blobPtr, ptr, long n, long iOffset ) = longtoolbox fn sqlite3_blob_write( sqlite3_blobPtr, ptr, long n, long iOffset ) = longBeginCFunctionchar * MYCFStringCopyUTF8String( CFStringRef aString ) {if ( aString == NULL ) {return NULL;}CFIndex length = CFStringGetLength( aString );CFIndex maxSize = CFStringGetMaximumSizeForEncoding( length, kCFStringEncodingUTF8 ) + 1;char *buffer = ( char * )malloc( maxSize );if (CFStringGetCString( aString, buffer, maxSize, kCFStringEncodingUTF8 )) {return buffer;}free(buffer ); // If we failedreturn NULL;}EndClocal fn SQL3LibVersionNumber'~'1cln return sqlite3_libversion_number();end fn = 0local fn SQL3VersionString as CFStringRef'~'1cln return StringWithCString( sqlite3_libversion(), NSUTF8StringEncoding );end fn = 0local fn SQL3Open( string as CFStringRef, db as sqlite3Ptr )'~'1cln return sqlite3_open( [(NSString * )string UTF8String], db );end fn = 0local fn SQL3Exec( db as sqlite3Ptr, string as CFStringRef )'~'1cln return sqlite3_exec( db, [(NSString * )string UTF8String], NULL, NULL, NULL );end fn = 0local fn SQL3TotalChanges( db as sqlite3Ptr )'~'1cln return sqlite3_total_changes( db );end fn = 0local fn SQL3Close( db as sqlite3Ptr )'~'1cln return sqlite3_close( db );end fn = 0local fn SQL3PrepareV2( db as sqlite3Ptr, query as CFStringRef, statement as sqlite3_stmtPtr )'~'1cln return sqlite3_prepare_v2( db, [(NSString * )query UTF8String], -1, statement, NULL );end fn = 0local fn SQL3Step( statement as sqlite3_stmtPtr )'~'1cln return sqlite3_step( statement );end fn = 0local fn SQL3DataCount( statement as sqlite3_stmtPtr )'~'1cln return (int)sqlite3_data_count( statement );end fn = 0local fn SQL3ColumnType( statement as sqlite3_stmtPtr, col as long )'~'1cln return (int)sqlite3_column_type( statement, col );end fn = 0local fn SQL3ColumnText( statement as sqlite3_stmtPtr, col as long ) as CFStringRef'~'1cln return (CFStringRef)[NSString stringWithUTF8String:(char* )sqlite3_column_text( statement, col )];end fn = NULLlocal fn SQL3ColumnName( statement as sqlite3_stmtPtr, col as long ) as CFStringRef'~'1cln return (CFStringRef)[NSString stringWithUTF8String:(char* )sqlite3_column_name( statement, col )];end fn = NULLlocal fn SQL3ColumnInt( statement as sqlite3_stmtPtr, col as long ) as long'~'1cln return (int)sqlite3_column_int( statement, col );end fn = 0local fn SQL3ColumnDouble( statement as sqlite3_stmtPtr, col as long ) as double'~'1cln return (double)sqlite3_column_double( statement, col );end fn = 0local fn SQL3Finalize( statement as sqlite3_stmtPtr )'~'1cln return sqlite3_finalize( statement );end fn = 0local fn SQL3ErrorMsg( db as sqlite3Ptr ) as CFStringRef'~'1cln return (CFStringRef)[NSString stringWithUTF8String:(char* )sqlite3_errmsg( db )];end fn = NULLlocal fn SQL3BindInt( statement as sqlite3_stmtPtr, index as long, value as long )'~'1cln return sqlite3_bind_int( statement, index, value );end fn = 0local fn SQL3BindDouble( statement as sqlite3_stmtPtr, index as long, value as float )'~'1cln return sqlite3_bind_double( statement, index, value );end fn = 0// Pass -1 for textLength to let function calculate length. Function accepts _SQLITESTATIC and _SQLITETRANSIENT instructions.local fn SQL3BindText( statement as sqlite3_stmtPtr, index as long, text as CFStringRef, textLength as long, instruction as long )'~'1// fn NSLog( @"Filter Value: '%@'", text )if instruction = _STATICcln return sqlite3_bind_text( statement, index, [(NSString *)text UTF8String], textLength, SQLITE_STATIC );elsecln return sqlite3_bind_text( statement, index, [(NSString *)text UTF8String], textLength, SQLITE_TRANSIENT );end ifend fn = 0