void local fn MyCustomCellCallback( tag as long, identifier as CFStringRef, row as NSInteger, vw as CFTypeRef, userData as ptr )'~'1CFDictionaryRef dict = fn ArrayObjectAtIndex( fn TableViewData( tag ), row )select ( fn ViewTag( vw ) )case _tableCheckboxButtonSetState( vw, fn NumberIntegerValue( fn DictionaryObjectForKey( dict, identifier ) ) )case _tablePopUpPopUpButtonSelectItemAtIndex( vw, fn NumberIntegerValue( fn DictionaryObjectForKey( dict, identifier ) ) )case _tableRatingControlSetIntegerValue( vw, fn NumberIntegerValue( fn DictionaryObjectForKey( dict, identifier ) ) )end selectend fn// menu events arrive herevoid local fn DoMenu( menuID as long, itemID as long )'~'1select case ( menuID )case _mFileselect case ( itemID )case _iClose : fn CloseSQLite3Databaseend selectend selectend fnvoid local fn DoToolbar( whichTag as long )//~NSLog(@"toolbar item %ld clicked", whichTag )select case ( whichTag )case _personButtonToolbarItemSetBordered( _mainToolbar, _personButton, YES )ToolbarItemSetEnabled( _mainToolbar, _personButton, NO )ToolbarItemSetBordered( _mainToolbar, _contactButton, NO )ToolbarItemSetEnabled( _mainToolbar, _contactButton, YES )ToolbarItemSetBordered( _mainToolbar, _addressButton, NO )ToolbarItemSetEnabled( _mainToolbar, _addressButton, YES )// hide and show viewsViewSetHidden( _personView, NO )ViewSetHidden( _contactView, YES )ViewSetHidden( _addressView, YES )case _contactButtonToolbarItemSetBordered( _mainToolbar, _personButton, NO )ToolbarItemSetEnabled( _mainToolbar, _personButton, YES )ToolbarItemSetBordered( _mainToolbar, _contactButton, YES )ToolbarItemSetEnabled( _mainToolbar, _contactButton, NO )ToolbarItemSetBordered( _mainToolbar, _addressButton, NO )ToolbarItemSetEnabled( _mainToolbar, _addressButton, YES )// hide and show viewsViewSetHidden( _personView, YES )ViewSetHidden( _contactView, NO )ViewSetHidden( _addressView, YES )case _addressButtonToolbarItemSetBordered( _mainToolbar, _personButton, NO )ToolbarItemSetEnabled( _mainToolbar, _personButton, YES )ToolbarItemSetBordered( _mainToolbar, _contactButton, NO )ToolbarItemSetEnabled( _mainToolbar, _contactButton, YES )ToolbarItemSetBordered( _mainToolbar, _addressButton, YES )ToolbarItemSetEnabled( _mainToolbar, _addressButton, NO )// hide and show viewsViewSetHidden( _personView,  YES )ViewSetHidden( _contactView, YES )ViewSetHidden( _addressView,  NO )case _preferencesButtonToolbarItemSetBordered( _mainToolbar, _preferencesButton, YES )' WindowBeginSheet( _window, _sheetWindow )end selectend fnvoid local fn DoDialog( whichEvent as long, whichTag as long, whichWindow as long )'~'1CFStringRef            identifierCFMutableDictionaryRef resultsDictionaryRefselect case ( whichWindow )'Main Window contains the Table Viewcase _windowselect case ( whichEvent )case _btnClick//~NSLog(@"single click")case _tableViewSelectionDidChangeSegmentedControlSetSegmentEnabled( _addRemoveSegment, _removeContactSegmentItem, ( fn TableViewSelectedRow( whichTag ) != -1 ))select case ( whichTag )case _contactListViewidentifier = fn DictionaryObjectForKey( fn ArrayObjectAtIndex( fn TableViewData( _contactListView ), fn TableViewSelectedRow( _contactListView )), @"ID" )resultsDictionaryRef = fn GetPersonByIDRecord( identifier )fn PopulatePersonView( resultsDictionaryRef )resultsDictionaryRef = fn GetAddressesByPersonIDRecord( identifier )fn PopulateAddressesView( resultsDictionaryRef )resultsDictionaryRef = fn GetContactsByPersonIDRecord( identifier )fn PopulateContactsView( resultsDictionaryRef )end selectcase _tableViewCellTextDidEndEditing'update cost cell when qty or price change'identifier = fn TableViewEventColumnIdentifier( tag )case _toolbarItemClick//~NSLog(@"toolbar item %ld clicked", whichTag )select case ( whichTag )case _personButtonfn DoToolbar( _personButton )case _contactButtonfn DoToolbar( _contactButton )case _addressButtonfn DoToolbar( _addressButton )case _preferencesButtonfn DoToolbar( _preferencesButton )end selectcase _viewAcceptsFirstResponderselect case ( whichTag )case _contactView//~NSLog(@"_viewAcceptsFirstResponder event for view %ld", whichTag )end selectcase _windowWillCloseif ( fn CloseSQLite3Database )endelse//~NSLog( @"Can't Close the database…" )end ifend select'Preferences Window contains Database Connection String, etc…case _preferencesWindowselect case ( whichEvent )case _btnClickselect case( whichTag )case _preferenceSaveButton' string = fn ControlStringValue( _preferenceDatabasePath )' WindowEndSheet( _window, _sheetWindow )' textfield 2,, string,,_windowcase _preferenceCancelButton' WindowEndSheet( _window, _sheetWindow )end selectToolbarItemSetBordered( _mainToolbar, _preferencesButton, NO )end selectend selectend fnvoid local fn DoAppEvent( whichEvent as long )'~'1' BOOL isConnected/* * * Does Preferences File Exist? * if exists *   then open preferences file *   read preferences into dictionary * if not exists *   then create preferences file *  */select ( whichEvent )case _appWillFinishLaunching//~NSLog(@"_appWillFinishLaunching")'fn OpenSQLite3DatabasegDatabaseURL = fn CreateGlobalURLgDBIsConnected = fn OpenSQLite3Database( gDatabaseURL )' fn CreateEmptySQLDatabaseif ( gDBIsConnected )fn TestSQLiteend if' fn TestSQLiteInsert' fn GetCustomers' fn ContactSampleDataBuildcase _appShouldTerminateAfterLastWindowClosedAppEventSetBool( YES ) ' tell the runtime we can quitend selectend fn